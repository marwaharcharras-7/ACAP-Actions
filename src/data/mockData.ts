import { Action, Service, Line, Team, Post, User, DashboardStats } from '@/types';

export const mockServices: Service[] = [
  { id: '1', name: 'Production', responsibleId: '2', responsibleName: 'Fatima Manager' },
  { id: '2', name: 'Qualité', responsibleId: '2', responsibleName: 'Fatima Manager' },
  { id: '3', name: 'Maintenance', responsibleId: '2', responsibleName: 'Fatima Manager' },
];

export const mockLines: Line[] = [
  { id: '1', name: 'Ligne A', serviceId: '1', serviceName: 'Production', teamLeaderId: '4', teamLeaderName: 'Marwa Chef' },
  { id: '2', name: 'Ligne B', serviceId: '1', serviceName: 'Production', teamLeaderId: '4', teamLeaderName: 'Marwa Chef' },
  { id: '3', name: 'Ligne C', serviceId: '2', serviceName: 'Qualité' },
];

export const mockTeams: Team[] = [
  { id: '1', name: 'Équipe Alpha', lineId: '1', lineName: 'Ligne A', leaderId: '4', leaderName: 'Marwa Chef' },
  { id: '2', name: 'Équipe Beta', lineId: '1', lineName: 'Ligne A', leaderId: '4', leaderName: 'Marwa Chef' },
  { id: '3', name: 'Équipe Gamma', lineId: '2', lineName: 'Ligne B' },
];

export const mockPosts: Post[] = [
  { id: '1', name: 'Poste 1', teamId: '1', teamName: 'Équipe Alpha', lineId: '1', lineName: 'Ligne A' },
  { id: '2', name: 'Poste 2', teamId: '1', teamName: 'Équipe Alpha', lineId: '1', lineName: 'Ligne A' },
  { id: '3', name: 'Poste 3', teamId: '2', teamName: 'Équipe Beta', lineId: '1', lineName: 'Ligne A' },
  { id: '4', name: 'Poste 4', teamId: '3', teamName: 'Équipe Gamma', lineId: '2', lineName: 'Ligne B' },
];

export const mockUsers: User[] = [
  {
    id: '1',
    email: 'admin@entreprise.com',
    firstName: 'Ahmed',
    lastName: 'Admin',
    role: 'admin',
    isActive: true,
    createdAt: '2024-01-01T08:00:00Z',
  },
  {
    id: '2',
    email: 'manager@entreprise.com',
    firstName: 'Fatima',
    lastName: 'Manager',
    role: 'manager',
    serviceId: '1',
    isActive: true,
    createdAt: '2024-01-01T08:00:00Z',
  },
  {
    id: '3',
    email: 'supervisor@entreprise.com',
    firstName: 'Karim',
    lastName: 'Superviseur',
    role: 'supervisor',
    serviceId: '1',
    lineId: '1',
    isActive: true,
    createdAt: '2024-01-01T08:00:00Z',
  },
  {
    id: '4',
    email: 'chef@entreprise.com',
    firstName: 'Marwa',
    lastName: 'Chef',
    role: 'team_leader',
    serviceId: '1',
    lineId: '1',
    teamId: '1',
    isActive: true,
    createdAt: '2024-01-01T08:00:00Z',
  },
  {
    id: '5',
    email: 'operateur@entreprise.com',
    firstName: 'Youssef',
    lastName: 'Operateur',
    role: 'operator',
    serviceId: '1',
    lineId: '1',
    teamId: '1',
    postId: '1',
    isActive: true,
    createdAt: '2024-01-01T08:00:00Z',
  },
  {
    id: '6',
    email: 'hiba@entreprise.com',
    firstName: 'Hiba',
    lastName: 'Ibourk',
    role: 'operator',
    serviceId: '1',
    lineId: '1',
    teamId: '1',
    postId: '2',
    isActive: true,
    createdAt: '2024-02-15T08:00:00Z',
  },
  {
    id: '7',
    email: 'wiam@entreprise.com',
    firstName: 'Wiam',
    lastName: 'Lamnaouar',
    role: 'team_leader',
    serviceId: '1',
    lineId: '2',
    teamId: '3',
    isActive: true,
    createdAt: '2024-02-20T08:00:00Z',
  },
];

const today = new Date();
const addDays = (date: Date, days: number) => {
  const result = new Date(date);
  result.setDate(result.getDate() + days);
  return result.toISOString();
};

export const mockActions: Action[] = [
  {
    id: '1',
    title: 'Calibration machine CNC',
    description: 'Recalibrer la machine CNC suite aux écarts détectés',
    problem: 'Écarts de précision détectés sur les pièces usinées',
    rootCause: 'Usure des guides linéaires',
    type: 'corrective',
    status: 'in_progress',
    urgency: 'high',
    category5M: 'machine',
    pilotId: '5',
    pilotName: 'Youssef Operateur',
    createdById: '4',
    createdByName: 'Marwa Chef',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    postId: '1',
    postName: 'Poste 1',
    dueDate: addDays(today, 3),
    createdAt: addDays(today, -7),
    updatedAt: addDays(today, -1),
    progressPercent: 60,
    comments: 'Pièces de rechange commandées',
  },
  {
    id: '2',
    title: 'Formation opérateurs nouvelles procédures',
    description: 'Former les opérateurs aux nouvelles procédures de sécurité',
    problem: 'Mise à jour des normes de sécurité',
    type: 'preventive',
    status: 'planned',
    urgency: 'medium',
    category5M: 'main_oeuvre',
    pilotId: '4',
    pilotName: 'Marwa Chef',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    dueDate: addDays(today, 10),
    createdAt: addDays(today, -3),
    updatedAt: addDays(today, -3),
    progressPercent: 0,
  },
  {
    id: '3',
    title: 'Remplacement capteur température',
    description: 'Remplacer le capteur défaillant sur la ligne B',
    problem: 'Capteur de température affichant des valeurs erronées',
    rootCause: 'Capteur endommagé',
    type: 'corrective',
    status: 'completed',
    urgency: 'high',
    category5M: 'machine',
    pilotId: '6',
    pilotName: 'Hiba Ibourk',
    createdById: '4',
    createdByName: 'Marwa Chef',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '2',
    lineName: 'Ligne B',
    teamId: '3',
    teamName: 'Équipe Gamma',
    postId: '4',
    postName: 'Poste 4',
    dueDate: addDays(today, -2),
    createdAt: addDays(today, -10),
    updatedAt: addDays(today, -3),
    completedAt: addDays(today, -3),
    progressPercent: 100,
    efficiencyPercent: 95,
    isEffective: true,
  },
  {
    id: '4',
    title: 'Optimisation flux matières premières',
    description: 'Réorganiser le stockage pour optimiser les flux',
    problem: 'Temps de manutention trop élevé',
    type: 'preventive',
    status: 'identified',
    urgency: 'low',
    category5M: 'methode',
    pilotId: '7',
    pilotName: 'Wiam Lamnaouar',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    dueDate: addDays(today, 20),
    createdAt: addDays(today, -1),
    updatedAt: addDays(today, -1),
    progressPercent: 0,
  },
  {
    id: '5',
    title: 'Nettoyage système ventilation',
    description: 'Effectuer le nettoyage périodique du système de ventilation',
    problem: 'Accumulation de poussière dans les conduits',
    type: 'preventive',
    status: 'late',
    urgency: 'medium',
    category5M: 'milieu',
    pilotId: '5',
    pilotName: 'Youssef Operateur',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    dueDate: addDays(today, -5),
    createdAt: addDays(today, -15),
    updatedAt: addDays(today, -5),
    progressPercent: 30,
  },
  {
    id: '6',
    title: 'Mise à jour documentation technique',
    description: 'Actualiser les manuels techniques des équipements',
    problem: 'Documentation obsolète',
    type: 'corrective',
    status: 'validated',
    urgency: 'low',
    category5M: 'methode',
    pilotId: '4',
    pilotName: 'Marwa Chef',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '2',
    serviceName: 'Qualité',
    lineId: '3',
    lineName: 'Ligne C',
    dueDate: addDays(today, -7),
    createdAt: addDays(today, -20),
    updatedAt: addDays(today, -6),
    completedAt: addDays(today, -8),
    validatedAt: addDays(today, -6),
    progressPercent: 100,
    efficiencyPercent: 100,
    isEffective: true,
  },
  {
    id: '7',
    title: 'Contrôle qualité matière première',
    description: 'Renforcer les contrôles à réception',
    problem: 'Lots non conformes détectés en production',
    rootCause: 'Contrôle insuffisant à réception',
    type: 'corrective',
    status: 'in_progress',
    urgency: 'high',
    category5M: 'matiere',
    pilotId: '6',
    pilotName: 'Hiba Ibourk',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '2',
    serviceName: 'Qualité',
    dueDate: addDays(today, 5),
    createdAt: addDays(today, -5),
    updatedAt: addDays(today, 0),
    progressPercent: 45,
  },
  {
    id: '8',
    title: 'Installation nouveau système d\'alarme',
    description: 'Installer un système d\'alarme incendie amélioré',
    problem: 'Système actuel obsolète',
    type: 'preventive',
    status: 'planned',
    urgency: 'medium',
    category5M: 'milieu',
    pilotId: '7',
    pilotName: 'Wiam Lamnaouar',
    createdById: '1',
    createdByName: 'Ahmed Admin',
    serviceId: '3',
    serviceName: 'Maintenance',
    dueDate: addDays(today, 15),
    createdAt: addDays(today, -2),
    updatedAt: addDays(today, -2),
    progressPercent: 0,
  },
  // Archived Actions
  {
    id: '9',
    title: 'Réparation convoyeur principal',
    description: 'Remplacement des rouleaux usés sur le convoyeur principal',
    problem: 'Blocages fréquents du convoyeur',
    rootCause: 'Usure des rouleaux après 3 ans d\'utilisation',
    type: 'corrective',
    status: 'archived',
    urgency: 'high',
    category5M: 'machine',
    pilotId: '5',
    pilotName: 'Youssef Operateur',
    createdById: '4',
    createdByName: 'Marwa Chef',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    postId: '1',
    postName: 'Poste 1',
    dueDate: addDays(today, -30),
    createdAt: addDays(today, -60),
    updatedAt: addDays(today, -28),
    completedAt: addDays(today, -29),
    validatedAt: addDays(today, -28),
    progressPercent: 100,
    efficiencyPercent: 98,
    isEffective: true,
  },
  {
    id: '10',
    title: 'Mise à jour procédure contrôle qualité',
    description: 'Révision complète des procédures de contrôle entrée',
    problem: 'Procédures obsolètes ne respectant plus les normes ISO',
    rootCause: 'Évolution des normes qualité',
    type: 'preventive',
    status: 'archived',
    urgency: 'medium',
    category5M: 'methode',
    pilotId: '6',
    pilotName: 'Hiba Ibourk',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '2',
    serviceName: 'Qualité',
    lineId: '3',
    lineName: 'Ligne C',
    dueDate: addDays(today, -45),
    createdAt: addDays(today, -90),
    updatedAt: addDays(today, -44),
    completedAt: addDays(today, -46),
    validatedAt: addDays(today, -44),
    progressPercent: 100,
    efficiencyPercent: 100,
    isEffective: true,
  },
  {
    id: '11',
    title: 'Formation sécurité incendie',
    description: 'Session de formation pour tout le personnel de la ligne A',
    problem: 'Formation périodique obligatoire',
    type: 'preventive',
    status: 'archived',
    urgency: 'low',
    category5M: 'main_oeuvre',
    pilotId: '4',
    pilotName: 'Marwa Chef',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    dueDate: addDays(today, -20),
    createdAt: addDays(today, -50),
    updatedAt: addDays(today, -18),
    completedAt: addDays(today, -19),
    validatedAt: addDays(today, -18),
    progressPercent: 100,
    efficiencyPercent: 95,
    isEffective: true,
  },
  {
    id: '12',
    title: 'Changement huile hydraulique',
    description: 'Vidange et remplacement de l\'huile hydraulique des presses',
    problem: 'Maintenance préventive planifiée',
    rootCause: 'Usure normale du fluide hydraulique',
    type: 'preventive',
    status: 'archived',
    urgency: 'medium',
    category5M: 'machine',
    pilotId: '7',
    pilotName: 'Wiam Lamnaouar',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '3',
    serviceName: 'Maintenance',
    lineId: '2',
    lineName: 'Ligne B',
    teamId: '3',
    teamName: 'Équipe Gamma',
    dueDate: addDays(today, -15),
    createdAt: addDays(today, -40),
    updatedAt: addDays(today, -14),
    completedAt: addDays(today, -16),
    validatedAt: addDays(today, -14),
    progressPercent: 100,
    efficiencyPercent: 92,
    isEffective: true,
  },
  {
    id: '13',
    title: 'Correction défaut soudure',
    description: 'Reprise des soudures défectueuses sur châssis',
    problem: 'Défauts de soudure détectés lors du contrôle',
    rootCause: 'Mauvais réglage du poste à souder',
    type: 'corrective',
    status: 'archived',
    urgency: 'high',
    category5M: 'machine',
    pilotId: '5',
    pilotName: 'Youssef Operateur',
    createdById: '4',
    createdByName: 'Marwa Chef',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '1',
    teamName: 'Équipe Alpha',
    postId: '2',
    postName: 'Poste 2',
    dueDate: addDays(today, -10),
    createdAt: addDays(today, -25),
    updatedAt: addDays(today, -12),
    completedAt: addDays(today, -13),
    validatedAt: addDays(today, -12),
    progressPercent: 100,
    efficiencyPercent: 88,
    isEffective: true,
  },
  {
    id: '14',
    title: 'Nettoyage filtres ventilation',
    description: 'Remplacement des filtres du système de ventilation',
    problem: 'Accumulation excessive de poussière',
    rootCause: 'Environnement poussiéreux',
    type: 'preventive',
    status: 'archived',
    urgency: 'low',
    category5M: 'milieu',
    pilotId: '6',
    pilotName: 'Hiba Ibourk',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '2',
    lineName: 'Ligne B',
    teamId: '3',
    teamName: 'Équipe Gamma',
    postId: '4',
    postName: 'Poste 4',
    dueDate: addDays(today, -8),
    createdAt: addDays(today, -30),
    updatedAt: addDays(today, -7),
    completedAt: addDays(today, -9),
    validatedAt: addDays(today, -7),
    progressPercent: 100,
    efficiencyPercent: 100,
    isEffective: true,
  },
  {
    id: '15',
    title: 'Recalibration balance de précision',
    description: 'Calibration annuelle de la balance de pesage',
    problem: 'Calibration périodique requise',
    type: 'preventive',
    status: 'archived',
    urgency: 'medium',
    category5M: 'machine',
    pilotId: '4',
    pilotName: 'Marwa Chef',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '2',
    serviceName: 'Qualité',
    lineId: '3',
    lineName: 'Ligne C',
    dueDate: addDays(today, -5),
    createdAt: addDays(today, -20),
    updatedAt: addDays(today, -4),
    completedAt: addDays(today, -6),
    validatedAt: addDays(today, -4),
    progressPercent: 100,
    efficiencyPercent: 100,
    isEffective: true,
  },
  {
    id: '16',
    title: 'Réparation fuite pneumatique',
    description: 'Colmatage fuite sur circuit pneumatique presse',
    problem: 'Perte de pression détectée',
    rootCause: 'Joint défectueux',
    type: 'corrective',
    status: 'archived',
    urgency: 'high',
    category5M: 'machine',
    pilotId: '7',
    pilotName: 'Wiam Lamnaouar',
    createdById: '4',
    createdByName: 'Marwa Chef',
    serviceId: '3',
    serviceName: 'Maintenance',
    lineId: '1',
    lineName: 'Ligne A',
    dueDate: addDays(today, -3),
    createdAt: addDays(today, -15),
    updatedAt: addDays(today, -5),
    completedAt: addDays(today, -6),
    validatedAt: addDays(today, -5),
    progressPercent: 100,
    efficiencyPercent: 94,
    isEffective: true,
  },
  {
    id: '17',
    title: 'Révision procédure stockage matières',
    description: 'Mise à jour des règles de stockage des matières premières',
    problem: 'Optimisation de l\'espace de stockage',
    rootCause: 'Augmentation du volume de production',
    type: 'preventive',
    status: 'archived',
    urgency: 'low',
    category5M: 'methode',
    pilotId: '5',
    pilotName: 'Youssef Operateur',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '1',
    lineName: 'Ligne A',
    teamId: '2',
    teamName: 'Équipe Beta',
    dueDate: addDays(today, -12),
    createdAt: addDays(today, -35),
    updatedAt: addDays(today, -10),
    completedAt: addDays(today, -14),
    validatedAt: addDays(today, -10),
    progressPercent: 100,
    efficiencyPercent: 85,
    isEffective: true,
  },
  {
    id: '18',
    title: 'Correction erreur de dosage',
    description: 'Ajustement paramètres doseur automatique',
    problem: 'Surdosage constaté sur lots',
    rootCause: 'Dérive capteur de niveau',
    type: 'corrective',
    status: 'archived',
    urgency: 'high',
    category5M: 'matiere',
    pilotId: '6',
    pilotName: 'Hiba Ibourk',
    createdById: '3',
    createdByName: 'Karim Superviseur',
    serviceId: '2',
    serviceName: 'Qualité',
    lineId: '3',
    lineName: 'Ligne C',
    dueDate: addDays(today, -7),
    createdAt: addDays(today, -18),
    updatedAt: addDays(today, -6),
    completedAt: addDays(today, -8),
    validatedAt: addDays(today, -6),
    progressPercent: 100,
    efficiencyPercent: 97,
    isEffective: true,
  },
  {
    id: '19',
    title: 'Mise en place 5S zone stockage',
    description: 'Application méthode 5S dans la zone de stockage',
    problem: 'Désorganisation de la zone',
    type: 'preventive',
    status: 'archived',
    urgency: 'medium',
    category5M: 'milieu',
    pilotId: '4',
    pilotName: 'Marwa Chef',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '2',
    lineName: 'Ligne B',
    teamId: '3',
    teamName: 'Équipe Gamma',
    dueDate: addDays(today, -25),
    createdAt: addDays(today, -55),
    updatedAt: addDays(today, -23),
    completedAt: addDays(today, -26),
    validatedAt: addDays(today, -23),
    progressPercent: 100,
    efficiencyPercent: 90,
    isEffective: true,
  },
  {
    id: '20',
    title: 'Formation utilisation nouvel ERP',
    description: 'Formation des opérateurs au nouveau module de suivi',
    problem: 'Changement de système informatique',
    type: 'preventive',
    status: 'archived',
    urgency: 'medium',
    category5M: 'main_oeuvre',
    pilotId: '7',
    pilotName: 'Wiam Lamnaouar',
    createdById: '2',
    createdByName: 'Fatima Manager',
    serviceId: '1',
    serviceName: 'Production',
    lineId: '2',
    lineName: 'Ligne B',
    teamId: '3',
    teamName: 'Équipe Gamma',
    dueDate: addDays(today, -2),
    createdAt: addDays(today, -22),
    updatedAt: addDays(today, -1),
    completedAt: addDays(today, -3),
    validatedAt: addDays(today, -1),
    progressPercent: 100,
    efficiencyPercent: 96,
    isEffective: true,
  },
];

export const getDashboardStats = (actions: Action[]): DashboardStats => {
  const stats: DashboardStats = {
    totalActions: actions.length,
    identified: actions.filter(a => a.status === 'identified').length,
    planned: actions.filter(a => a.status === 'planned').length,
    inProgress: actions.filter(a => a.status === 'in_progress').length,
    completed: actions.filter(a => a.status === 'completed').length,
    late: actions.filter(a => a.status === 'late').length,
    validated: actions.filter(a => a.status === 'validated').length,
    archived: actions.filter(a => a.status === 'archived').length,
    onTimeRate: 0,
    avgEfficiency: 0,
  };

  const completedOrValidated = actions.filter(a => a.status === 'completed' || a.status === 'validated');
  const onTime = completedOrValidated.filter(a => {
    if (a.completedAt) {
      return new Date(a.completedAt) <= new Date(a.dueDate);
    }
    return false;
  });
  
  stats.onTimeRate = completedOrValidated.length > 0 
    ? Math.round((onTime.length / completedOrValidated.length) * 100) 
    : 0;

  const withEfficiency = actions.filter(a => a.efficiencyPercent !== undefined);
  stats.avgEfficiency = withEfficiency.length > 0
    ? Math.round(withEfficiency.reduce((acc, a) => acc + (a.efficiencyPercent || 0), 0) / withEfficiency.length)
    : 0;

  return stats;
};

export const getStatusChartData = (actions: Action[]) => [
  { name: 'Identifiées', value: actions.filter(a => a.status === 'identified').length, color: 'hsl(199, 89%, 48%)' },
  { name: 'Prévues', value: actions.filter(a => a.status === 'planned').length, color: 'hsl(38, 92%, 50%)' },
  { name: 'En cours', value: actions.filter(a => a.status === 'in_progress').length, color: 'hsl(217, 91%, 40%)' },
  { name: 'Finalisées', value: actions.filter(a => a.status === 'completed').length, color: 'hsl(142, 71%, 45%)' },
  { name: 'En retard', value: actions.filter(a => a.status === 'late').length, color: 'hsl(0, 84%, 60%)' },
  { name: 'Validées', value: actions.filter(a => a.status === 'validated').length, color: 'hsl(142, 71%, 35%)' },
];

export const getMonthlyChartData = (actions: Action[]) => {
  const months = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'];
  const currentMonth = new Date().getMonth();
  
  return months.slice(0, currentMonth + 1).map((month, index) => {
    const monthActions = actions.filter(a => {
      const actionMonth = new Date(a.createdAt).getMonth();
      return actionMonth === index;
    });
    
    const completed = actions.filter(a => {
      if (a.completedAt) {
        const completedMonth = new Date(a.completedAt).getMonth();
        return completedMonth === index;
      }
      return false;
    });

    const validated = actions.filter(a => {
      if (a.validatedAt) {
        const validatedMonth = new Date(a.validatedAt).getMonth();
        return validatedMonth === index;
      }
      return false;
    });

    return {
      name: month,
      created: monthActions.length,
      completed: completed.length,
      validated: validated.length,
    };
  });
};
